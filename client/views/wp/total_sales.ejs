<%- include('../partials/header') -%>
<%- include('../partials/navbar') -%>
<div class="wp-wrapper">
  <ul class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/wp">Water Purifier</a></li>
    <li>Total Sales</li>
</ul>
    <div class="wp-inner"> 
      <div style="margin-top: 10px;">
        <input type="text" id="tableSearch" onkeyup="filterTable()" placeholder="Search With Name">
        <input type="number" id="tableSearch1" onkeyup="filterTableWithNumber()" placeholder="Search With Number">
      </div>
      <a href="javascript:void(0)" class="add">Add<span><i class="fas fa-plus"></i></span></a>
            <div class="modal" id="modal">
              <div class="modal-head">
                <h3>Add a client</h3>
                <a href="javascript:void(0)" class="close" id="hideModal"><span><i class="fas fa-times"></i></span></a>
              </div>               
                <form action="/wpAddClient" method="POST">
                    <div>
                        <label for="custName">Customer Name: <span>*</span></label>
                        <input type="text" name="custName" required >
                    </div>
                    <% if(user !== null){ %>
                        <input type="hidden" name="creatorName" value="<%= user.name %>">
                    <% } %>
                    <input type="hidden" name="custId" value="<%= 'cyrus'+parseInt(clients.length+1) %>" >
                    <div>
                        <label for="prodName">Product Name: <span>*</span></label>
                        <input type="text" name="prodName" required >
                    </div>
                    <div>
                        <label for="reference">Reference: <span>*</span></label>
                        <input type="text" name="reference" required >
                    </div>
                    <div>
                        <label for="phNumber">Phone Number: <span>*</span></label>
                        <input type="text" name="phNumber" required>
                    </div>
                    <div>
                        <label for="phNumber1">Alternate Phone Number:</label>
                        <input type="text" name="phNumber1" >
                    </div>
                    <div>
                        <label for="address">Address: <span>*</span></label>
                        <input type="text" name="address" required>
                    </div>
                    <div>
                        <label for="instDate">Installation Date: <span>*</span></label>
                        <input type="date" name="instDate" required>
                    </div>
                    <div>
                        <label for="instExec">Installation Executive: <span>*</span></label>
                        <input type="text" name="instExec" required>
                    </div>
                    <div>
                        <label for="amount">Amount: <span>*</span></label>
                        <input type="number" name="amount" required>
                    </div>
                    <div>
                        <label for="paymentMode">Payment Mode: <span>*</span></label>
                        <select name="paymentMode" id="paymentMode" required>
                          <option selected disabled>Select a mode</option>
                          <option value="Cash">Cash</option>
                          <option value="Cheque">Cheque</option>
                        </select>
                    </div>
                    <div id="bankInfo">
                      <label for="amount">Bank Info:</label>
                      <input type="number" name="accNo" placeholder="Account Number" >
                      <input type="text" name="branchName" placeholder="Branch Name" >
                      <input type="number" name="chequeNo" placeholder="Cheque Number" >
                      <label for="chequeDate">Cheque Date:</label>
                      <input type="date" name="chequeDate"  >
                    </div>
                    
                    <div>
                      <label for="remarks">Remarks:</label>
                      <input type="text" name="remarks" >
                    </div>
                    <div class="emi-checkbox">
                        <input type="checkbox" name="emi" > EMI
                    </div>
                    <div id="advanceAmount">
                      <label for="advAmount">Advance Amount:</label>
                      <input type="number" name="advAmount" >
                    </div>
                    <div id="duration">
                      <div>
                        <div class="radio-btn-wrapper">
                          <label for="duration">2 Months</label>
                          <input type="radio" name="duration" value="2 Months"> 
                        </div>
                        <div class="radio-btn-wrapper">
                          <label for="radioBtn">3 Months</label>
                          <input type="radio" name="duration" value="3 Months"> 
                        </div>
                      </div>
                    </div>
                    <button type="submit">Add</button>
                </form>
            </div>
            <button class="downloadAsPdf"  onclick="downloadPageAsExcel('wpTable', 'totalSales')">Download table as excel <i class="far fa-file-excel"></i></button>
        <table class="wptable" id="wpTable">
            <tr>
              <th>Customer Id</th>
              <th>Customer name</th>
              <th>Product name</th>
              <th>Ph Number</th>
              <th>Address</th>
              <th>Installation Date</th>
              <th>Installation Executive</th>
              <th>Amount</th>
              <th>Payment Mode</th>
              <th>Remarks</th>
              <th>EMI</th>
            </tr>
            <% if(clients.length > 0){ %> 
              <% clients.forEach((client, index) => { %>
                <tr>
                  <td class="editable_cell" style="padding-right: 20px"><%= client.customerId %>
                    <form action="/showSingleCust" method="POST">
                      <input type="hidden" name="id" value="<%= client._id %>">
                      <button type="submit" class="edit"><i class="fas fa-eye"></i></button>
                    </form>
                  </td>
                  <td><%= client.customerName %></td>
                  <td><%= client.productName %></td>
                  <td><%= client.phoneNumber %></td>
                  <td><%= client.address %></td>
                  <td><%= client.installationDate.toLocaleDateString() %></td>
                  <td><%= client.installationExecutive %></td>
                  <td>&#8377; <%= client.amount %></td>
                  <td><%= client.paymentMode %></td>
                  
                  <% if(client.remarks !== "") { %>
                    <td><%= client.remarks %></td>
                  <% }else{ %>
                    <td style="background-color: #ccc;"></td>
                  <% } %>
                  
                  <td>
                    <% if(client.emi){ %>
                      <form action="/checkEMI" method="POST">
                        <input type="hidden" name="id" value="<%= client._id %>">
                        <button class="true-emi"><i class="fas fa-check"></i></button>
                      </form>
                    <% }else{ %>
                      <button class="false-emi" style="pointer-events: none"><i class="fas fa-times"></i></button>
                    <% } %>
                  </td>
                </tr>
              <% }) %>                      
            <% } %>                     
          </table>
    </div>
</div>
<%- include('../partials/footer') -%>